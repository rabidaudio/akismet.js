<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>lib\client.js - Akismet.js</title>

    <meta name="application-name" content="Akismet.js">
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, width=device-width">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Akismet.js">

    <link rel="apple-touch-icon" href="../assets/apple-touch-icon.png">
    <link rel="icon" href="../assets/favicon.ico">
    <link rel="stylesheet" href="../assets/css/default.min.css">
    <link rel="stylesheet" href="../assets/vendor/prism-light.css">
  </head>

  <body data-assets="../assets" data-base-url="../" data-theme="default">
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <header><nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-target="#menu" data-toggle="collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../">
        <img alt="" src="http://dev.belin.io/akismet.js/favicon.ico">
        Akismet.js
      </a>
    </div>

    <div class="collapse navbar-collapse" id="menu">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">
            Project <span class="caret"></span>
          </a>
          <ul class="dropdown-menu">
            <li><a href="../"><i class="fa fa-fw fa-sitemap"></i> Overview</a></li>
            <li><a href="https://www.npmjs.org/package/akismet-js" rel="external" target="_blank"><i class="fa fa-fw fa-home"></i> Homepage</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">
            Show <span class="caret"></span>
          </a>
          <ul id="menu-visibility" class="dropdown-menu">
            <li><a href="#api-show-inherited"><i class="fa fa-fw fa-check-square-o"></i> Inherited</a></li>
            <li><a href="#api-show-protected"><i class="fa fa-fw fa-check-square-o"></i> Protected</a></li>
            <li><a href="#api-show-private"><i class="fa fa-fw fa-square-o"></i> Private</a></li>
            <li><a href="#api-show-deprecated"><i class="fa fa-fw fa-square-o"></i> Deprecated</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">
            <span class="hidden-xs"><i class="fa fa-question-circle fa-lg"></i> <span class="caret"></span></span>
            <span class="visible-xs-inline">Help <span class="caret"></span></span>
          </a>
          <ul class="dropdown-menu">
            <li class="dropdown-header">DocGen.js</li>
            <li><a href="https://github.com/cedx/docgen.js/wiki" rel="external" target="_blank"><i class="fa fa-book fa-fw"></i> Online Help</a></li>
            <li><a href="https://github.com/cedx/docgen.js/issues" rel="external" target="_blank"><i class="fa fa-bug fa-fw"></i> File an Issue</a></li>
            <li><a href="https://github.com/cedx/docgen.js" rel="external" target="_blank"><i class="fa fa-code fa-fw"></i> Get the Source</a></li>
          </ul>
        </li>
      </ul>
      <form id="api-search" class="navbar-form navbar-right">
        <div class="input-group">
          <input type="search" class="form-control" placeholder="Search docs and APIs">
          <span class="input-group-btn">
            <button type="submit" class="btn btn-primary"><i class="fa fa-search"></i></button>
          </span>
        </div>
      </form>
    </div>
  </div>
</nav>
</header>

    <main class="container">
      <div class="row">
        <article class="col-sm-8 col-sm-push-4 col-md-9 col-md-push-3">
          <section id="title" class="hidden">lib\client.js - Akismet.js</section>
          <section id="content"><div class="page-header">
  <h1>lib\client.js <small>File</small></h1>
</div>

<pre class="line-numbers"><code>/**
 * Contains classes that provide a simple programming interface for querying the [Akismet](https://akismet.com) service.
 * @module client
 */
&#x27;use strict&#x27;;

// Module dependencies.
var enums=require(&#x27;./enums&#x27;);
var request=require(&#x27;superagent&#x27;);
var url=require(&#x27;url&#x27;);
var util=require(&#x27;util&#x27;);

/**
 * Represents the front page or home URL transmitted when making requests.
 * @class akismet.Blog
 * @constructor
 * @param {String} url The blog or site URL.
 * @param {Object} [options] An object specifying additional values used to initialize this instance.
 */
function Blog(url, options) {

  /**
   * The character encoding for the values included in comments.
   * @property charset
   * @type String
   */
  this.charset=null;

  /**
   * The language(s) in use on the blog or site.
   * @property language
   * @type String
   */
  this.language=null;

  /**
   * The blog or site URL.
   * @property url
   * @type String
   */
  this.url=(typeof url==&#x27;string&#x27; ? url : null);

  // Initialize the instance.
  if(options &amp;&amp; typeof options==&#x27;object&#x27;)
    for(var key in options)
      if(this.hasOwnProperty(key) &amp;&amp; options[key]) this[key]=options[key];
}

/**
 * Creates a new author from the specified JSON string.
 * @method fromJSON
 * @param {Object|String} json A JSON string, or an already parsed object, representing an author.
 * @return {akismet.Blog} The instance corresponding to the specified JSON object, or &#x60;null&#x60; if a parsing error occurred.
 * @static
 */
Blog.fromJSON=function(json) {
  var map;
  if(typeof json!=&#x27;string&#x27;) map=json;
  else {
    try { map=JSON.parse(json); }
    catch(e) { return null; }
  }

  return !map || typeof map!=&#x27;object&#x27; ? null : new Blog(map.blog, {
    charset: map.blog_charset,
    language: map.blog_lang
  });
};

/**
 * Converts this object to a string in JSON format.
 * @method toJSON
 * @return {String} The JSON representation of this object.
 */
Blog.prototype.toJSON=function() {
  var map={};
  if(typeof this.url==&#x27;string&#x27;) map.blog=this.url;
  if(typeof this.charset==&#x27;string&#x27;) map.blog_charset=this.charset;
  if(typeof this.language==&#x27;string&#x27;) map.blog_lang=this.language;
  return JSON.stringify(map);
};

/**
 * Returns a string representation of this object.
 * @method toString
 * @return {String} The string representation of this object.
 */
Blog.prototype.toString=function() {
  return &#x27;Blog &#x27;+this.toJSON();
};

/**
 * Provides the base class for clients that submit comments to [Akismet](https://akismet.com) service.
 * @class akismet.Client
 * @constructor
 * @param {String} apiKey The Akismet API key used to query the service.
 * @param {String|akismet.Blog} blog The front page or home URL transmitted when making requests.
 * @param {Object} [options] An object specifying additional values used to initialize this instance.
 */
function Client(apiKey, blog, options) {

  /**
   * The Akismet API key.
   * @property apiKey
   * @type String
   */
  this.apiKey=String(apiKey);

  /**
   * The front page or home URL of the instance making requests.
   * @property blog
   * @type akismet.Blog
   */
  this.blog=(blog instanceof Blog ? blog : new Blog(blog));

  /**
   * The user agent string to use when making requests.
   * If possible, the user agent string should always have the following format: &#x60;Application Name/Version | Plugin Name/Version&#x60;.
   * @property userAgent
   * @type String
   */
  this.userAgent=util.format(&#x27;Node.js/%s | Akismet.js/%s&#x27;, typeof window!=&#x27;undefined&#x27; ? &#x27;0.0.0&#x27; : process.version, require(&#x27;../package.json&#x27;).version);

  /**
   * The URL of the remote service.
   * @property serviceUrl
   * @type String
   * @default &quot;https://rest.akismet.com&quot;
   */
  this.serviceUrl=&#x27;https://&#x27;+Client.DEFAULT_SERVICE;

  // Initialize the instance.
  if(options &amp;&amp; typeof options==&#x27;object&#x27;)
    for(var key in options)
      if(this.hasOwnProperty(key) &amp;&amp; options[key]) this[key]=options[key];
}

/**
 * The host of the default remote service.
 * @property DEFAULT_SERVICE
 * @type String
 * @static
 * @final
 */
Client.DEFAULT_SERVICE=&#x27;rest.akismet.com&#x27;;

/**
 * Checks the specified comment against the service database, and returns a value indicating whether it is spam.
 * @method checkComment
 * @param {akismet.Comment} comment The comment to be checked.
 * @param {Function} callback The callback to invoke at the end. It is passed two arguments:
 * - &#x60;error&#x60; containing the error that occurred, if any.
 * - &#x60;isSpam&#x60; indicating whether the specified comment is spam.
 * @async
 */
Client.prototype.checkComment=function(comment, callback) {
  var serviceUrl=url.parse(this.serviceUrl);

  var endPoint=(
    serviceUrl.host!=Client.DEFAULT_SERVICE ?
    url.resolve(this.serviceUrl, enums.EndPoints.CHECK_COMMENT) :
    util.format(&#x27;%s//%s.%s%s&#x27;,
      serviceUrl.protocol,
      this.apiKey,
      serviceUrl.host,
      enums.EndPoints.CHECK_COMMENT
    )
  );

  this._queryService(endPoint, JSON.parse(comment.toJSON()), function(err, res) {
    if(err) callback(err, false);
    else callback(null, res==&#x27;true&#x27;);
  });
};

/**
 * Submits the specified comment that was incorrectly marked as spam but should not have been.
 * @method submitHam
 * @param {akismet.Comment} comment The comment to be submitted.
 * @param {Function} [callback] The callback to invoke at the end. It is passed one argument &#x60;error&#x60; containing the error that occurred, if any.
 * @async
 */
Client.prototype.submitHam=function(comment, callback) {
  var serviceUrl=url.parse(this.serviceUrl);

  var endPoint=(
    serviceUrl.host!=Client.DEFAULT_SERVICE ?
    url.resolve(this.serviceUrl, enums.EndPoints.SUBMIT_HAM) :
    util.format(&#x27;%s//%s.%s%s&#x27;,
      serviceUrl.protocol,
      this.apiKey,
      serviceUrl.host,
      enums.EndPoints.SUBMIT_HAM
    )
  );

  this._queryService(endPoint, JSON.parse(comment.toJSON()), callback);
};

/**
 * Submits the specified comment that was not marked as spam but should have been.
 * @method submitSpam
 * @param {akismet.Comment} comment The comment to be submitted.
 * @param {Function} [callback] The callback to invoke at the end. It is passed one argument &#x60;error&#x60; containing the error that occurred, if any.
 * @async
 */
Client.prototype.submitSpam=function(comment, callback) {
  var serviceUrl=url.parse(this.serviceUrl);

  var endPoint=(
    serviceUrl.host!=Client.DEFAULT_SERVICE ?
    url.resolve(this.serviceUrl, enums.EndPoints.SUBMIT_SPAM) :
    util.format(&#x27;%s//%s.%s%s&#x27;,
      serviceUrl.protocol,
      this.apiKey,
      serviceUrl.host,
      enums.EndPoints.SUBMIT_SPAM
    )
  );

  this._queryService(endPoint, JSON.parse(comment.toJSON()), callback);
};

/**
 * Returns a string representation of this object.
 * @method toString
 * @return {String} The string representation of this object.
 */
Client.prototype.toString=function() {
  return util.format(&#x27;Client { apiKey: &quot;%s&quot;, blog: &quot;%s&quot;, serviceUrl: &quot;%s&quot;, userAgent: &quot;%s&quot; }&#x27;,
    this.apiKey,
    this.blog.url,
    this.serviceUrl,
    this.userAgent
  );
};

/**
 * Checks the API key against the service database, and returns a value indicating whether it is valid.
 * @method verifyKey
 * @param {Function} callback The callback to invoke at the end. It is passed two arguments:
 * - &#x60;error&#x60; containing the error that occurred, if any.
 * - &#x60;isValid&#x60; indicating whether the API key is valid.
 * @async
 */
Client.prototype.verifyKey=function(callback) {
  var endPoint=url.resolve(this.serviceUrl, enums.EndPoints.VERIFY_KEY);
  this._queryService(endPoint, {}, function(err, res) {
    if(err) callback(err, false);
    else callback(null, res==&#x27;valid&#x27;);
  });
};

/**
 * Queries the service by posting the specified fields to a given end point, and returns the response as a string.
 * @method _queryService
 * @param {String} endPoint The URL of the end point to query.
 * @param {Object} fields The fields describing the query body.
 * @param {Function} callback The callback to invoke at the end. It is passed two arguments:
 * - &#x60;error&#x60; containing the error that occurred, if any.
 * - &#x60;response&#x60; containing the response body returned by the remote service.
 * @private
 * @async
 */
Client.prototype._queryService=function(endPoint, fields, callback) {
  fields.key=this.apiKey;
  fields.blog=this.blog.url;
  if(this.blog.charset) fields.blog_charset=this.blog.charset;
  if(this.blog.lang) fields.blog_lang=this.blog.lang;

  request
    .post(endPoint)
    .type(&#x27;form&#x27;)
    .set(typeof window!=&#x27;undefined&#x27; ? enums.HTTPHeaders.X_USER_AGENT : &#x27;user-agent&#x27;, this.userAgent)
    .send(fields)
    .end(function(err, res) {
      if(err) callback(err, null);
      else if(!res.ok) callback(new Error(res.error ? res.error.toString() : res.status), null);
      else {
        var akismetHeader=enums.HTTPHeaders.X_AKISMET_DEBUG_HELP;
        callback(akismetHeader in res.header ? new Error(res.header[akismetHeader]) : null, res.text);
      }
    });
};

// Public interface.
module.exports={
  Blog: Blog,
  Client: Client
};
</code></pre>
</section>
          <section id="results" class="hidden"></section>
        </article>

        <aside class="col-sm-4 col-sm-pull-8 col-md-3 col-md-pull-9"><h3>APIs</h3>

<ul class="nav nav-tabs nav-justified">
  
    <li class="active"><a href="#api-classes" data-toggle="tab"><i class="fa fa-cube"></i> Classes</a></li>
  
  
    <li class=""><a href="#api-modules" data-toggle="tab"><i class="fa fa-cubes"></i> Modules</a></li>
  
</ul>

<div class="tab-content">
  <p>
    <input id="api-filter" class="form-control" placeholder="Type to filter APIs" type="search">
  </p>

  
    <div id="api-classes" class="tab-pane active">
      <ul class="list-group">
        
          <a class="list-group-item ellipsis" href="../classes/akismet.Author.html">akismet.Author</a>
        
          <a class="list-group-item ellipsis" href="../classes/akismet.Blog.html">akismet.Blog</a>
        
          <a class="list-group-item ellipsis" href="../classes/akismet.Client.html">akismet.Client</a>
        
          <a class="list-group-item ellipsis" href="../classes/akismet.Comment.html">akismet.Comment</a>
        
          <a class="list-group-item ellipsis" href="../classes/akismet.CommentType.html">akismet.CommentType</a>
        
          <a class="list-group-item ellipsis" href="../classes/akismet.EndPoints.html">akismet.EndPoints</a>
        
          <a class="list-group-item ellipsis" href="../classes/akismet.HTTPHeaders.html">akismet.HTTPHeaders</a>
        
          <a class="list-group-item ellipsis" href="../classes/akismet.Server.html">akismet.Server</a>
        
      </ul>
    </div>
  

  
    <div id="api-modules" class="tab-pane">
      <ul class="list-group">
        
          <a class="list-group-item ellipsis" href="../modules/client.html">client</a>
        
          <a class="list-group-item ellipsis" href="../modules/comment.html">comment</a>
        
          <a class="list-group-item ellipsis" href="../modules/enums.html">enums</a>
        
          <a class="list-group-item ellipsis" href="../modules/server.html">server</a>
        
      </ul>
    </div>
  
</div>
</aside>
      </div>
    </main>

    <footer class="hidden-xs">
      <nav class="navbar navbar-inverse">
        <div class="container">
          <ul class="nav navbar-nav">
            <li><p class="navbar-text">API Docs for: <strong>0.3.2</strong></p></li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li><a href="https://github.com/cedx/docgen.js" rel="external" target="_blank" title="Generated by DocGen.js">DocGen.js</a></li>
          </ul>
        </div>
      </nav>
    </footer>

    <script src="../assets/js/web.min.js"></script>
    <script src="../assets/vendor/prism.js" data-manual></script>
  </body>
</html>
